# ThÃ´ng tin giao thÃ´ng ğŸš¦

## ğŸ‰ Giá»›i thiá»‡u

ÄÃ¢y lÃ  dá»± Ã¡n thÃ´ng tin giao thÃ´ng táº¡i BÃ¬nh Äá»‹nh sá»­ dá»¥ng há»‡ thá»‘ng camera Ä‘Æ°á»£c thiáº¿t láº­p sáºµn Ä‘á»ƒ há»— trá»£ cÃ¡c cÃ´ng ty vÃ  chÃ­nh phá»§ trong viá»‡c kiá»ƒm soÃ¡t an ninh vÃ  tÃ¬nh tráº¡ng giao thÃ´ng trong khu vá»±c.

## âœ¨ CÃ¡c tÃ­nh nÄƒng

- ÄÄƒng kÃ½, Ä‘Äƒng nháº­p, Ä‘Äƒng xuáº¥t ngÆ°á»i dÃ¹ng vá»›i Auth0
- XÃ¡c thá»±c ngÆ°á»i dÃ¹ng: 
+ PhÃ¢n quyá»n, báº£o vá»‡ `route` theo quyá»n Ä‘Æ°á»£c cho phÃ©p. 
+ Kiá»ƒm tra náº¿u khÃ´ng cÃ³ quyá»n Ä‘Æ°á»£c cho phÃ©p thÃ¬ sáº½ chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang `/unauthorized`.
+ Kiá»ƒm tra xem ngÆ°á»i dÃ¹ng cÃ³ bá»‹ khÃ³a hay khÃ´ng, náº¿u cÃ³ thÃ¬ sáº½ hiá»ƒn thá»‹ thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng biáº¿t tÃ i khoáº£n Ä‘Ã£ bá»‹ khÃ³a.
+ Báº£n Ä‘á»“: xem tá»•ng quan cÃ¡c thÃ´ng tin vá» cáº£nh bÃ¡o giao thÃ´ng, camera giao thÃ´ng, cÃ´ng trÃ¬nh thi cÃ´ng, bÃ£i Ä‘á»— xe, phÃ¢n luá»“ng giao thÃ´ng vÃ  thÃ´ng tin tÄ©nh. 
- Quáº£n lÃ½:
+ ` Cáº£nh bÃ¡o giao thÃ´ng:` táº¡o cáº£nh bÃ¡o, hiá»ƒn thá»‹ cÃ¡c cáº£nh bÃ¡o má»›i
+ ` Camera giao thÃ´ng:` hiá»ƒn thá»‹ danh sÃ¡ch cÃ¡c camera theo khu vá»±c, thÃªm - xÃ³a - sá»­a camera vÃ  nhÃ³m camera theo quyá»n `admin` hoáº·c `superadmin`, xuáº¥t dá»¯ liá»‡u: csv, excel, json theo quyá»n `admin` hoáº·c `superadmin`
+ ` CÃ´ng trÃ¬nh thi cÃ´ng:` hiá»ƒn thá»‹ danh sÃ¡ch cÃ¡c cÃ´ng trÃ¬nh thi cÃ´ng, thÃªm - xÃ³a - sá»­a dá»¯ liá»‡u cÃ´ng trÃ¬nh theo quyá»n `admin` hoáº·c `superadmin`, xuáº¥t dá»¯ liá»‡u: csv, excel, json theo quyá»n `admin` hoáº·c `superadmin`
+ ` BÃ£i Ä‘á»— xe:` hiá»ƒn thá»‹ danh sÃ¡ch cÃ¡c bÃ£i Ä‘á»— xe, thÃªm - xÃ³a - sá»­a dá»¯ liá»‡u bÃ£i Ä‘á»— xe theo quyá»n `admin` hoáº·c `superadmin`, xuáº¥t dá»¯ liá»‡u: csv, excel, json theo quyá»n `admin` hoáº·c `superadmin`
+ ` PhÃ¢n luá»“ng giao thÃ´ng:` hiá»ƒn thá»‹ danh sÃ¡ch phÃ¢n luá»“ng giao thÃ´ng, thÃªm - xÃ³a - sá»­a dá»¯ liá»‡u phÃ¢n luá»“ng giao thÃ´ng theo quyá»n `admin` hoáº·c `superadmin`, xuáº¥t dá»¯ liá»‡u: csv, excel, json theo quyá»n `admin` hoáº·c `superadmin`
+ ` Lá»›p thÃ´ng tinh tÄ©nh:` hiá»ƒn thá»‹ danh sÃ¡ch thÃ´ng tin tÄ©nh, thÃªm - xÃ³a - sá»­a dá»¯ liá»‡u lá»›p thÃ´ng tin tÄ©nh theo quyá»n `admin` hoáº·c `superadmin`, xuáº¥t dá»¯ liá»‡u: csv, excel, json theo quyá»n `admin` hoáº·c `superadmin`
- Quáº£n trá»‹:
+ ` Cáº¥u hÃ¬nh:` cáº¥u hÃ¬nh tÃ¬nh tráº¡ng camera, tÃ¬nh tráº¡ng giao thÃ´ng, sá»± kiá»‡n giao thÃ´ng theo quyá»n `admin` hoáº·c `superadmin` .
+ ` NgÆ°á»i dÃ¹ng:` hiá»ƒn thá»‹ danh sÃ¡ch ngÆ°á»i dÃ¹ng trong há»‡ thá»‘ng, thá»‘ng kÃª tÃ i khoáº£n, chá»‰nh sá»­a quyá»n ngÆ°á»i dÃ¹ng: `khÃ¡ch`, `ngÆ°á»i dÃ¹ng`, `quáº£n lÃ½`. `KhÃ³a` vÃ  `má»Ÿ khÃ³a` ngÆ°á»i dÃ¹ng
+ ` NhÃ³m ngÆ°á»i dÃ¹ng:` hiá»ƒn thá»‹ danh sÃ¡ch nhÃ³m ngÆ°á»i dÃ¹ng, thÃªm nhÃ³m ngÆ°á»i dÃ¹ng vÃ  thiáº¿t láº­p quyá»n Ä‘Æ°á»£c cho phÃ©p: `khÃ´ng cÃ³ quyá»n`, `truy cáº­p`, `chá»‰nh sá»­a`, `quáº£n lÃ½` vÃ o cÃ¡c tÃ i nguyÃªn há»‡ thá»‘ng.
- Thá»‘ng kÃª:
+ `Thá»‘ng kÃª cáº£nh bÃ¡o:` hiá»ƒn thá»‹ biá»ƒu Ä‘á»“ cÃ¡c cáº£nh bÃ¡o theo `ngÃ y`, `hÃ ng tuáº§n`, `hÃ ng thÃ¡ng`.

## ğŸ’» CÃ´ng nghá»‡ sá»­ dá»¥ng
- [Angular](https://angular.io/)
- [NodeJS](https://nodejs.org/en/)
- [MongoDB](https://www.mongodb.com/)
- [Auth0](https://auth0.com/)
- vÃ  cÃ¡c cÃ´ng nghá»‡ khÃ¡c

## ğŸ‘¤ PhÃ­a ngÆ°á»i dÃ¹ng

Dá»± Ã¡n Ä‘Æ°á»£c táº¡o vá»›i [Angular CLI](https://github.com/angular/angular-cli)  v13.2.5.
Äá»ƒ cháº¡y dá»± Ã¡n báº¡n cáº§n pháº£i cÃ i Ä‘áº·t cÃ¡c module, báº¡n cáº§n sá»­ dá»¥ng cÃ¢u lá»‡nh `npm install`, sau Ä‘Ã³ sá»­ dá»¥ng cÃ¢u lá»‡nh `npm start` Ä‘á»ƒ cháº¡y dá»± Ã¡n phÃ­a ngÆ°á»i dÃ¹ng

### âš™ï¸ Thiáº¿t láº­p Auth0
- Sá»­ dá»¥ng cÃ¢u lá»‡nh Ä‘á»ƒ cÃ i Ä‘áº·t module Auth0: `npm install @auth0/auth0-angular`
- Má»Ÿ file `app.module.ts` sau Ä‘Ã³ cáº¥u hÃ¬nh theo dÆ°á»›i Ä‘Ã¢y:

```
 import { BrowserModule } from '@angular/platform-browser';
 import { NgModule } from '@angular/core';
 import { AuthModule } from '@auth0/auth0-angular';
 import { AppComponent } from './app.component';

 @NgModule({
   declarations: [AppComponent],
   imports: [
     BrowserModule,
     AuthModule.forRoot({
       domain: 'YOUR_DOMAIN',
       clientId: 'YOUR_CLIENT_ID'
     }),
   ],
   bootstrap: [AppComponent],
 })
 export class AppModule {}
 ```
 
- Äá»ƒ cáº¥u hÃ¬nh Auth0 quyá»n ngÆ°á»i cáº§n lÃ m theo cÃ¡c bÆ°á»›c sau Ä‘Ã¢y:
+ VÃ o trang Auth0: Chá»n Auth Pipeline ==> chá»n Rule ==> Chá»n Create ==> Empty Rule ==> Táº¡o Name vÃ  dÃ¡n Ä‘oáº¡n mÃ£ sau Ä‘Ã¢y vÃ o Script:

``` 
function (user, context, callback) {
  user.app_metadata = user.app_metadata || {};
  // You can add a Role based on what you want
  // In this case I check domain
  var addRolesToUser = function(user, cb) { 
    if (user.app_metadata.roles) {
      return cb(null, user.app_metadata.roles);
    } else {
      return cb(null, ['guest']);
    }
  };

  addRolesToUser(user, function(err, roles) {
    if (err) {
      callback(err);
    } else {
      user.app_metadata.roles = roles;
      auth0.users.updateAppMetadata(user.user_id, user.app_metadata)
        .then(function(){
        context.idToken.roles = user.app_metadata.roles; 
        user.roles = roles;
          callback(null, user, context);
        })
        .catch(function(err){
          callback(err);
        }); 
    }
  });
}
```

Sau Ä‘Ã³ nháº¥n Save change.

- Äá»ƒ cáº¥u hÃ¬nh Auth0 tráº£ vá» `appmetadata` trong `access token` ta lÃ m cÃ¡c bÆ°á»›c nhÆ° cáº¥u hÃ¬nh quyá»n ngÆ°á»i dÃ¹ng vá»›i Auth Pipeline á»Ÿ trÃªn:
+ dÃ¡n Ä‘oáº¡n mÃ£ sau Ä‘Ã¢y vÃ o Script:

```
function (user, context, callback) {
  const namespace = 'https://hoang0650.com';
  const assignedRoles = (context.authorization || {}).roles;
  let idTokenClaims = context.idToken || {};
  let accessTokenClaims = context.accessToken || {};
  idTokenClaims[`${namespace}/roles`] = assignedRoles;
  accessTokenClaims[`${namespace}/roles`] = assignedRoles;
  context.idToken = idTokenClaims;
  context.accessToken = accessTokenClaims;
  if (context.idToken && user.user_metadata) {
     context.idToken[namespace + '/user_metadata'] = user.user_metadata;
  }
   if (context.idToken && user.app_metadata) {
     context.idToken[namespace + '/app_metadata'] = user.app_metadata;
  }

 return callback(null, user, context);
}
```

Sau Ä‘Ã³ nháº¥n Save change.

- Äá»ƒ cáº¥u hÃ¬nh Auth0 tráº£ vá» name vÃ  appmetadata trong `access token`:
+ dÃ¡n Ä‘oáº¡n mÃ£ sau Ä‘Ã¢y vÃ o Script:

```
function (user, context, callback) {
  var namespace = "https://hoang0650.com";
  user.app_metadata = user.app_metadata || {};
  user.permissions = user.permissions || {};
  //var appmeta = (context.authorization || {}).app_metadata;
  user.name = user.name || {};
  context.accessToken[`${namespace}/app_metadata`] = user.app_metadata; 
  context.accessToken[`${namespace}/name`] = user.name;
  context.accessToken[`${namespace}/permission`] = user.permissions;
  callback(null, user, context);
}
```

Sau Ä‘Ã³ nháº¥n Save change.

## ğŸ–¥ PhÃ­a mÃ¡y chá»§

- Dá»± Ã¡n Ä‘Æ°á»£c táº¡o vá»›i [NodeJS](https://nodejs.org/en/)  v14.15.4.
- Äá»ƒ cháº¡y dá»± Ã¡n báº¡n cáº§n pháº£i cÃ i Ä‘áº·t cÃ¡c module, báº¡n cáº§n sá»­ dá»¥ng cÃ¢u lá»‡nh `npm install`, sau Ä‘Ã³ sá»­ dá»¥ng cÃ¢u lá»‡nh `npm start` Ä‘á»ƒ cháº¡y dá»± Ã¡n phÃ­a mÃ¡y chá»§

## âœ… Kiá»ƒm thá»­
- TÃ i khoáº£n dÃ nh cho `khÃ¡ch`: `email` guest@gmail.com `password` Guest123@
- TÃ i khoáº£n dÃ nh cho `ngÆ°á»i dÃ¹ng`: `email` user@gmail.com `password` User123@
- TÃ i khoáº£n dÃ nh cho `quáº£n lÃ½`: `email` admin@gmail.com `password` Admin123@
- TÃ i khoáº£n dÃ nh cho `siÃªu quáº£n lÃ½`: `email` superadmin@gmail.com `password` Superadmin123@  

